## 计算机网络

计算机网络就是互联的、自治的计算机集合。自治指的是所有的计算机直接没有主从关系；互联指的是互联互通，能进行数据交换。

计算机网络的本质是一种通信网络，只不过信源和信宿都是主机。它是计算机技术和通信技术的结合。

**信道**

信道是数据交换的载体。狭义上说人和人之间交流所承载信息的空气就是信道。广义上说它还可以包括有关的变换装置，这样的话信道往往被分成信道编码器、信道本身和信道译码器。简易通信系统模型如下：

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/cb141b56-b5ee-4a92-9d19-2be0a5a24e75" /></div>

## 计算机网络基本原理

分组交换技术，也就是拆分分组、传输分组、合并分组的技术。这个技术的优点就是便宜，因为把数据打包成分组和分组拆分都在计算机中进行，网络上只进行分组的转发，就使得网络的结构很简单，路由器设计也很简单。这一中原则被叫做“端到端的原则”，即能在端系统做的事情不在网络上实现。

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/e86bd0fa-aeae-45e2-afb5-c10e2b8af5d3" style="width:60%;" /></div>
**主机（host）**

诸如手机、电脑、服务器等端系统（end systems）。

**交换机**

如果想实现多个计算机之间的互联，按照之前的想法是每两台计算机进行连接，但这样太麻烦，一个好的做法是把这个计算机连接在某一中心上，这个中心把所有连接上来的计算机进行互联，在链路层这个中心叫做交换机。

<div align='center' ><img src="http://q0l9qvfyx.bkt.clouddn.com/540709b5-356a-40fd-96f6-bff6dfd4b7e7" style="width:25%"/></div>
**分组**

分组是带有地址信息的信息小片，可以理解成是计算机把一个文件切片后打成的包裹，由两部分构成：地址信息和真正传输的东西。

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/9f112321-0df3-423e-bd4f-0f1311fccf6b" /></div>
**路由器**

是计算机网络的一种专用计算机，它只有一个功能，就是转发分组。可以简单的理解为路由器是电子化的邮局，全国所有的邮局之间互联，是包裹能够传递，路由器之间互联，是分组能够正确转发。

路由器和交换机的区别是：交换机将计算机连在一起，构成局域网；路由器将局域网连在一起，形成互联网。



### **分组交换技术**

1. 一个主机至少连接一个路由器：数据最终是通过路由器进行转发的，所以一个主机至少得连接一个路由器。
2. 分组存储转发：分组完全进入路由器后，路由器按照地址信息检索转发表。注意不是第一个bit或Byte进入时就开始转发，是全部进入才转发。
3. 分组独立选择路径：一个文件被分成多个分组，但这些分组之间是独立的，路由器给他们看成相互独立的数据。分组的组装是通过接收方进行的，和网络无关。



## Internet

**ISP**

ISP，全称为Internet Service Provider，因特网服务提供商，即指提供互联网服务的公司。能提供拨号上网服务、网上浏览、下载文件、收发电子邮件等服务。

**不同角度看Internet**

- 组成细节角度：ISP网络互联形成的网络之网络。由运行各种网路应用的计算设备，光纤、铜缆、无线电等通信链路、路由器和交换机等组成的分组交换设备组成。

- 服务角度：是为网络应用提供通信服务的通信基础设施和为网络应用提供的应用编程接口。



### Internet结构

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/6c2e0e1d-7464-4e21-9613-555098981116" style="width:70%;" /></div> 
- `一级ISP包含`：网通、电信等商业ISP，还包含谷歌、微软等内容提供商网络。

- `IXP`：全称：Internet eXchange Point，即互联网交换中心。互联网Internet是由众多的网络互相连接而形成的全球性网络，互联网交换中心负责这些不同的网络之间互相通信的交换点，是互联网的关键基础设施。



## 网络的结构

- 网络边缘：位于“网络边缘”运行网络应用程序的端系统。


- 接入网络、物理介质：有线或无线的通信链路。


- 网络核心：互联的路由器（或分组转发设备）。构成“网络之网络”的关键。

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/be135250-0412-4b86-8a24-fc9721f3e72a" style="width:25%;" /></div>
### 接入网络

接入网络是一种用户网络，它连接用户到特定的服务提供商并通过承载网络到达其他网络。两个被用户关心的特征：带宽（数据传输速率，bps）、独占/共享（独占是带宽为某用户独用，共享是多个用户分用同一带宽）。

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/f3a7b5dd-8def-42e9-a42b-dab1f978146a" style="width:45%;" /></div>
**家庭接入**

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/4e2f6236-0695-4119-aeab-83a40f1c6872" style="width:60%;" /></div>
**机构（企业）接入**

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/746d62b1-e5b4-45c2-add6-ab4481d685d5" style="width:55%;" /></div>
**无线局域网**

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/fbf80f8f-4746-447e-a9b6-aef4e6efe108" style="width:25%;"  /></div>
**广域局域网**

 <div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/5b47b9b2-71be-4283-8fc5-ee8199b954d2" style="width:30%;" /></div>

### 网络核心

网络核心的功能是：路由（routing）：确定分组从源到目的传输路径；转发（forwarding）：将分组从路由器的输入端口交换至正确的输出端口。

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/62b0406d-4aef-4de6-8280-651809e62c3f" style="width:70%;" /></div>

## 数据交换方式

### 电路交换

包含三个阶段：建立连接、通信、释放连接。最显著的特点是独占电路资源。最典型的是电话网络。（下图的中继线上可以存在多组用户通信，详见复用技术）

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/d6034a53-8e86-47fc-bf19-5bf762352514" style="width:80%;" /></div> 

### 报文交换

报文交换是指把信息整个打包，然后经过存储转发送到目的地。



### 分组交换

分组交换是把信息拆分成不同的分组，然后把所有的分组相继发送给路由器，路由器通过路由&转发把数据传输到目的地。

- 和报文交换的区别是：报文交换不拆分信息。


- 和电路交换的区别是：如果把每个分组看成原子单位，区别就是各分组走不同的路径，不需要独占资源。

#### 分组交换的优势

- 和报文交换相比：速度快，因为在报文交换时，同一时间只有一个路由器在工作，其他路由器在等待。路由器的存储空间小，最低存储空间和分组大小差不多。


- 和电路交换相比：分组交换允许更多用户同时使用网络，让网络资源充分共享。

#### 分组交换的劣势

可能产生拥塞（congestion）：分组延迟和丢失。需要协议处理可靠数据传输和拥塞控制。



### 图解三种交换

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/8285469f-5cc3-4866-8578-a7a72f4aba93" style="width:80%;" /></div>

## 网络性能参数

**速率 & 带宽**

- 速率：又称数据率，数据传输速率或比特率。单位bps、kbps、Mbps、Gbps。
- 带宽：数字信道所能传输的最大数据率。单位bps等。

**丢包**

如果路由器的缓存满了，再到达的分组会被路由器丢弃，即造成丢包现象。丢包率 = 丢包数 / 已发分组数。

**分组延迟**

- 结点处理延迟：差错检测、确定输出链路；


- 排队延迟：等待输出链路可用、取决于路由器拥塞程度；


- 传输延迟：分组长度/链路带宽；


- 传播延迟：物理链路长度/信号传输速度。

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/bb29b169-33bb-4979-a91e-c1e282396508" style="width:60%;" /></div>
**流量强度**

设链路带宽为R(bps)，分组长度为L(bits)，平均每组到达速率为v。则：

- $L \ast v / R \longrightarrow 0 $时：平均排队延迟很小；


- $L \ast v / R \longrightarrow 1$时：平均排队延迟很大；


- $L \ast v / R > 1$时：超出服务能力，延迟 趋向于 无限大。

**时延带宽积**

$时延带宽积 = 传播时延 \ast 带宽$，单位：bit。实际意义是：从我们向某一信道上发送第一个bit，到这个bit被接收方接受这个时间里，发送方总共向信道上发送了多少bit。也可以称为以比特为单位的链路长度，比如某段链路长度为n比特。

**吞吐率/量（Throughput）**

发送端与接收端之间的传送数据率（b/s）。端到端的吞吐量取决于瓶颈链路。



## 网络协议

network protocol。为进行网络中的数据交换而建立的规则、标准或约定。其中规定了通信实体之间所交换的消息的格式、意义、顺序以及针对收到的消息或发生的事件而产生的动作。也可以说网络协议规定了网络中所有信息的发送和接受过程。

**协议三要素**

- 语义：语义是解释控制信息每个部分的意义。它规定了需要发出何种控制信息，以及完成的动作与做出什么样的响应。


- 语法：语法是用户数据与控制信息的结构与格式，以及数据出现的顺序。


- 时序：时序是对事件发生顺序的详细说明。（也可称为“同步”）。


总结：语义表示要做什么，语法表示要怎么做，时序表示做的顺序。



## 网络体系结构

指通信系统的整体设计，它为网络硬件、软件、协议、存取控制和拓扑提供标准。计算机网络是一个非常复杂的系统，需要解决的问题很多并且性质各不相同。所以，在设计时使用了“分层”的思想，即将庞大而复杂的问题分为若干较小的易于处理的局部问题。各层之间是按照功能进行分层的，同时每层遵循相应的网络协议完成本层功能。

<div align="center"><img width="80%" src="http://q0l9qvfyx.bkt.clouddn.com/db782db0-9889-4ba0-a9a3-92684553f7b5" /></div>
**各层的主要功能**

- 应用层：为用户提供具体的网络应用服务。
- 运输层：通过中间网络，两个主机中进程之间的通信服务。包含有可靠通信的协议TCP和无可靠性的协议UDP。
- 网络层：两台主机间的通信。分组交换网上的两台主机间的通信，选择合适的路由，构建互联网络，这些是同一件事的不同说法。
- 数据链路层：两个相邻结点之间，数据的可靠传输。
- 物理层：透明地传送比特流。

<div align="center"><img width="60%" src="http://q0l9qvfyx.bkt.clouddn.com/b7177899-d60c-43b9-b045-50e37fddc7bc" /></div>
**各层传输数据的叫法**

- 协议数据单元PDU（Protocol Data Unit）：对等层之间传送数据的单位。

- 服务数据单元SDU（Service Data Unit）：层与层之间交换数据的单位。

即：`PDU=首部+SDU=下一层的SDU`。

<div align="center"><img width="50%" src="http://q0l9qvfyx.bkt.clouddn.com/c00de438-4b7e-4c9e-8039-fa14b1376978" /></div>

## 码元

假如基带信号是`101011000110111010...`，如果直接发送，则每个码元携带一个比特的信息（每个码元只有2种状态），但是如果将信号中的三个比特编为一组，即101，011，000，110，111，010...，三个比特共有8种不同的排列，我们可以用不同的调制方法来表示这种信，如8种不同的振幅，频率，相位等，如果采用相位调制，相位$\phi_0$表示000，$\phi_1$表示001，以此类推，那么接收端如果收到相位是$\phi_0$的信号就知道表示的是000，以此类推，这样一个码元就不知不觉的传输了三个比特位的信号，此时每个码元有8种状态。一个码元可表示的比特数越多，则在接收端进行解调时要正确识别每一种状态就越困难。

**编码级别**

如果把n个比特编码成一个码元，则此时编码状态$M=2^n$，其表示当前传输时有多少不同的状态，如8级编码，会有：`000、001、010 …`，共计8种状态。



## 信道的极限容量

数据通信中很自然很重要的一个问题：在一个通道中，能够以多快的速率发送数据，即每秒钟能发送多少比特？比特是由电磁信号携带的，所以这个问题要再拆分一下：

1. 问题1：在一个通道中，能够以多快的速率发送信号？
2. 问题2：一个信号能携带多少个比特？



### 奈斯准则

**码间串扰**

码元的传输速率是有限制的，超过某上限就会出现码间串扰问题。这是由于在真正传输中，信号在传输时都不是理想化的，如下图就是理想化的高低电平和真实传输时的高低电平。

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/86866885-db6c-4686-a45d-f1c29d05e60a" style="width:40%;" /></div>
假如此时速度太快，就可能把低电平和高电平弄混。而最高的码元传输速率被奈斯准则限制。

**奈斯准则内容**

- 理想低通信道（能通过信号频率在某值之下）的最高码元传输速率为：$2W Baud$。

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/68d8fe1f-0d45-4778-b233-ca72ca0cb4fd" style="width:80%;" /></div>
- 理想带通信道（能通过信号频率在某范围之内）的最高码元传输速率为：$1W Baud$。

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/7ec776ff-084d-4641-884e-c82bf93ae0b4" style="width:80%;" /></div>
W是理想低通信道的带宽，单位为赫(Hz)。Baud 是波特，是码元传输速率的单位，1 波特为每秒传送 1 个码元。

- 波特率：单位时间内数据通信系统所传输的码元个数（信号个数），单位是波特（Baud）。

- 比特率：表示单位时间内数据通信系统传输的比特数，单位是比特/秒（b/s或bps）。$比特率 = 波特率 * log_2M$



### 香农公式

**编码级数限制**

虽然码元传输速率有限制，但是如果我们能尽可能提高编码级数不就能提升信息传输速率了吗？但事实上信号传输速率不受限于调制技术，而是受限于信噪比。举个例子，如果我们是在天气晴朗的一天出门，我们穿任意颜色衣服都能被分辨出来，但是如果我们在沙尘暴天气出门，穿`橘黄`和`橙黄`两种颜色的衣服别人自然就认不出来了。在这个比喻中衣服的颜色代表码元，确定衣服的颜色代表信息，沙尘暴就是噪声。

**香农公式内容**

带宽受限且有高斯白噪声干扰的信道的极限信息传输速率$C=W \ast log_2(1+PS/PN)（b/s）$。

- 其中$W$是信道的带宽。$PS$是信号的能量。$PN$是噪声的能量。
- 信噪比：$S/N=10lg{PS/PN}$。

举例：带宽是`1MHz`，信噪比是`24dB`，则信道的最高信息传输速率：$C=1M \ast log_2{(1+(10^{2.4}))}=7.98Mbps$。



### 奈氏准则vs香农公式

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/6011892c-da47-4cf8-a1e8-a7acf176cd0f" style="width:80%;" /></div> 

## 多路复用

电路交换中独占电路资源，并不是指用户线和中继线都被此次交换所独占，而是说在两个用户建立连接之后，除非连接中断，否则他们当前所拥有的资源不会被释放，即使他们之间不传输信息。而如何在中继线上实现多组用户通信就是多路复用技术。

产生多路复用的物理基础是：传输媒体的带宽或容量往往会大于传输单一信号的需求，使用多路复用，为了有效地利用通信线路，希望一个信道同时传输多路信号。

这种技术会将链路/网络资源（如带宽）划分为“资源片”，将资源片分配给各路“呼叫”（calls），每路呼叫独占分配到的资源片进行通信，资源片可能“闲置”

常见的复用技术有：频分多路复用、时分多路复用、波分多路复用、码分多路复用。

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/a0a4f676-e2fd-47d2-bdbb-566054c38206" style="width:80%;" /></div> 
**频分多路复用**

FMD：Frequency-division multiplexing，是指载波带宽被划分为多种不同频带的子信道，每个子信道可以并行传送一路信号的一种多路复用技术。也就是说信道的可用频带被分成若干个互不交叠的频段，每路信号用其中一个频段传输，因而可以用滤波器将它们分别滤出来，然后分别解调接收。

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/e2799478-b496-4a0a-853f-bfc708b69443" style="width:40%;" /></div>
**时分多路复用**

TDM：time division multiplexing，它使不同的信号在不同的时间内传送，将整个传输时间分为许多时间间隔（Time Slot，TS，又称为时隙），每个时间片被一路信号占用。TDM就是通过在时间上交叉发送每一路信号的一部分来实现一条电路传送多路信号的。电路上的每一短暂时刻只有一路信号存在。因数字信号是有限个离散值，所以TDM多应用于数字通信系统。

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/64c09afb-772f-43a0-90a9-cd44eeec4368" style="width:70%;" /></div>
**波分多路复用**

将两种或多种不同波长的光载波信号（携带各种信息）在发送端经复用器（亦称合波器，Multiplexer）汇合在一起，并耦合到光线路的同一根光纤中进行传输的技术；在接收端，经解复用器（亦称分波器或称去复用器，Demultiplexer）将各种波长的光载波分离，然后由光接收机作进一步处理以恢复原信号。

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/08d98e2f-6c88-430f-9bb7-e055f3c4b476" style="width:70%;" /></div>
**码分多路复用**

为每个用户分配一个唯一的mbit的码片序列（chipping sequence），二进制下的0用-1表示，二进制下的1用+1表示。在信道上传输的信号 = 原始数据 * 码片序列，比如码片序列是：(-1, 1, 1)，需要传一个0，应该是 -1 * (-1, 1, 1)，所以传输的就是(1, -1, -1)。

同时为了保证数据之间不相互影响，被共享的用户所占有的码片应该相互正交的。即：$\frac{1}{m}S_i \cdot S_j = 0 (i \neq j)$。而信道上真正传输的数据是各用户发送数据的叠加值。

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/79261e94-12b6-41c9-a4e0-0759e893e6ea" style="width:80%;" /></div> 

## 数字信号在模拟信道传输

数字信号需要编码后才能传输。常见的三种编码：

1. NRZ编码：进制数字0、1分别用两种电平来表示。常用-5V表示1，+5V表示0。
2. 曼切斯特编码：用电压的变化表示0和1：高→低 <=> 0，低→高 <=> 1。
3. 差分曼切斯特编码：在码元开始处有无跳变来表示0和1：有 <=> 0，无 <=> 1。

<div align='center'><img src="http://q0l9qvfyx.bkt.clouddn.com/e8108185-883f-4246-92a3-e68184a1baf8" style="width:80%;" /></div> 
